<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>卡特兰数 题解 - sun123zxy's Blog</title>

        <script src="/assets/thirds/jquery/jquery-3.5.1.min.js"></script>

        <link rel="stylesheet" href="/assets/thirds/katex/katex.min.css">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="/assets/thirds/katex/katex.min.js"></script>
        <!-- To automatically render math in text elements, include the auto-render extension -->
        <script defer src="/assets/thirds/katex/auto-render.min.js" onload="renderMathInElement(document.body)"></script>
        
        <script src="/assets/thirds/highlight/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
    </head>
    <body>
        <div id="home">
    <div id="main" class="panel panel-content">
        <div class="post-body">
    <div class="post-head">
        <h1 id="post-title">卡特兰数 题解</h1>
        <p class="abstract text-vice">
            
                No abstract provided here.
            
        </p>
    </div>
    <div class="post-content"><p><a
href="https://oj.bashu.com.cn/code/problempage.php?problem_id=7107">bsoj7107</a>
，来源不明。</p>
<blockquote>
<p><strong>卡特兰数</strong></p>
<p><strong>题目描述</strong></p>
<p>今天，接触信息学不久的小A刚刚学习了卡特兰数。</p>
<p>卡特兰数的一个经典定义是，将 <span class="math inline">\(n\)</span>
个数依次入栈，合法的出栈序列个数。</p>
<p>小A觉得这样的情况太平凡了。于是，他给出了 <span
class="math inline">\(m\)</span> 组限制，每个限制形如 <span
class="math inline">\((f_i,g_i)\)</span> ，表示 <span
class="math inline">\(f_i\)</span> 不能在 <span
class="math inline">\(g_i\)</span> 之后出栈。</p>
<p>他想求出：在满足了这 <span class="math inline">\(m\)</span>
组限制的前提下，共有多少个合法的出栈序列。他不喜欢大数，你只需要求出答案在模
<span class="math inline">\(998244353\)</span> 意义下的值即可。</p>
<p><strong>输入格式</strong></p>
<p>输入第一行为两个非负整数 <span class="math inline">\(n\)</span> 、
<span class="math inline">\(m\)</span> ，含义题面已给出。</p>
<p>接下来 <span class="math inline">\(m\)</span> 行，每行两个正整数，
<span class="math inline">\((f_i,g_i)\)</span> 表示一组限制。</p>
<p><strong>输出格式</strong></p>
<p>输出一行，为一个非负整数，表示你求得的答案 <span
class="math inline">\(\mod 998244353\)</span> 。</p>
<p><strong>样例输入</strong></p>
<pre><code>3 1
2 3</code></pre>
<p><strong>样例输出</strong></p>
<pre><code>3</code></pre>
<p><strong>样例解释</strong></p>
<p>可以验证 <span class="math inline">\(\{1,2,3 \}\)</span> ， <span
class="math inline">\(\{2,1,3 \}\)</span> ， <span
class="math inline">\(\{2,3,1 \}\)</span> 都是合乎条件的。</p>
<p><strong>数据规模</strong></p>
<p><span class="math inline">\(n \le 300\)</span> , <span
class="math inline">\(m \le \frac{n(n-1)}{2}\)</span> , <span
class="math inline">\(f_i,g_i \le n\)</span> 。</p>
<p>部分数据的 <span class="math inline">\(m\)</span> 较小。</p>
</blockquote>
<p><del>考前一天写题解会不会涨RP</del></p>
<p>套路但是还是感觉很巧妙的转换。关键在于把限制形式化的写出来方便观察。</p>
<p>考虑Catalan数的递推公式推导方式——枚举最后出栈的元素 <span
class="math inline">\(k\)</span> 。其递推式为 <span
class="math display">\[
\begin{aligned}
c_0 &amp;= 1 \\
c_n &amp;= \sum_{k=1}^n c_{k-1} c_{n-k}
\end{aligned}
\]</span> 加入限制后无法使用排列的相对顺序dp，故需改造原来的递推。定义
<span class="math inline">\(h_{l,r}\)</span> 为排列 <span
class="math inline">\([l,r]\)</span>
不同的出栈序列方案数，若暂不考虑限制，有 <span class="math display">\[
h_{l,r} = \sum_{k=l}^r h_{l,k-1} h_{k+1,r}
\]</span> 显然 <span class="math inline">\(c_n = h_{1,n}\)</span> 。</p>
<p>递推中，出栈序列的相对顺序为 <span
class="math inline">\(([l,k-1],[k+1,r],\{ k \})\)</span> 。限制 <span
class="math inline">\((f_i, g_i)\)</span> 要求 <span
class="math inline">\(f_i\)</span> 在 <span
class="math inline">\(g_i\)</span> 之前出栈。故满足 <span
class="math inline">\(g_i \in [l,k-1], \ f_i \in [k,r]\)</span> 或者
<span class="math inline">\(g_i \in [k+1,r], \ f_i = k\)</span> 的 <span
class="math inline">\(k\)</span> 都不合法，不应对 <span
class="math inline">\(h_{l,r}\)</span>
产生贡献。故在此dp中枚举所有限制判断合法性即可获得 <span
class="math inline">\(O(n^3 m)\)</span> 的算法。</p>
<p>这种方法看着就很naive，考虑优化合法性判断。容易发现把 <span
class="math inline">\((f_i,g_i)\)</span>
投到二维平面上后，判断合法性只需询问 <span class="math inline">\((k,l) -
(r,k-1)\)</span> 、 <span class="math inline">\((k,k+1) - (k,r)\)</span>
两个矩形中是否有点。二维前缀和处理即可 <span
class="math inline">\(O(1)\)</span> 判断。于是这样就可以 <span
class="math inline">\(O(n^3)\)</span> 通过本题了。</p>
<pre class="cpp"><code>#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;cmath&gt;
#include&lt;cstdlib&gt;
using namespace std;
typedef long long ll;
ll Rd(){
    ll ans=0;bool fh=0;char c=getchar();
    while(c&lt;&#39;0&#39;||c&gt;&#39;9&#39;){if(c==&#39;-&#39;) fh=1; c=getchar();}
    while(c&gt;=&#39;0&#39;&amp;&amp;c&lt;=&#39;9&#39;) ans=ans*10+c-&#39;0&#39;,c=getchar();
    if(fh) ans=-ans;
    return ans;
}
const ll MOD=998244353;
#define _ %MOD
ll PMod(ll x){
    if(x&gt;=MOD) return x-MOD;
    else if(x&lt;0) return x+MOD;
    else return x;
}

const ll MXN=305;
ll N,M;
ll A[MXN][MXN];
ll S[MXN][MXN];
void SpawnSum(){
    for(ll i=1;i&lt;=N;i++)
        for(ll j=1;j&lt;=N;j++)
            S[i][j]=S[i-1][j]+S[i][j-1]-S[i-1][j-1]+A[i][j];
}
bool Check(ll x1,ll y1,ll x2,ll y2){
    return S[x2][y2]-S[x1-1][y2]-S[x2][y1-1]+S[x1-1][y1-1];
}
ll f[MXN][MXN];
void Solve(){
    for(ll i=0;i&lt;=N;i++) f[i+1][i]=1;
    for(ll len=1;len&lt;=N;len++){
        for(ll l=1;l+len-1&lt;=N;l++){
            ll r=l+len-1;
            for(ll k=l;k&lt;=r;k++){
                if(Check(k,l,r,k-1)) continue;
                if(Check(k,k+1,k,r)) continue;
                f[l][r]=(f[l][r]+f[l][k-1]*f[k+1][r])_;
            }
        }
    }
    cout&lt;&lt;f[1][N];
}
int main(){
    N=Rd();M=Rd();
    for(ll i=0;i&lt;=N;i++) for(ll j=0;j&lt;=N;j++) A[i][j]=S[i][j]=0;
    for(ll i=1;i&lt;=M;i++){
        ll x=Rd(),y=Rd();
        A[x][y]=1;
    }
    SpawnSum();
    Solve();
    return 0;
}</code></pre>
</div>
    <div class="post-tags text-vice" style="text-align: right">
        <p>tags: 
            
                <a href= "/tags#OI" >OI</a>, 
            
                <a href= "/tags#题解" >题解</a>
            
        </p>
        <p>posted on 2020/12/04 | last modified on 2020/12/04</p>
    </div>
    
        <div class="post-comments">
            <script src="https://giscus.app/client.js"
                data-repo="sun123zxy/sun123zxy.github.io"
                data-repo-id="MDEwOlJlcG9zaXRvcnkzMTAwMzQxNDc="
                data-category="General"
                data-category-id="DIC_kwDOEnq-484CQKFr"
                data-mapping="pathname"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="light"
                data-lang="en"
                crossorigin="anonymous">
            </script>
        </div>
    
</div>
    </div>
    <div id="sidebar">
        
            <div id="sidebar-profile" class="panel">
                
                <div class="panel-content">
                    <a href="/"><img class="avatar" src="/assets/images/pig.png"></img></a>
<p class="nickname">sun123zxy</p>
<div class="nav">
    <a href="/">Home</a> | 
    <a href="/p/aboutme">About</a> | 
    <a href="/tags">Tags</a>
</div>
<div class="feed">
    <img src="/assets/images/feed.png"></img>
    <a href="/feed.xml">Atom Feed</a>
</div>
<p>Next Phantasm...</p>
                </div>
            </div>
        
            <div id="sidebar-news" class="panel">
                
                <h2 class="panel-title">News</h2>
                
                <div class="panel-content">
                    <a href="https://info.flagcounter.com/1Zpv"><img src="https://s05.flagcounter.com/count2/1Zpv/bg_DDDDDD/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_3/labels_0/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>

<p>博客已迁移。访问 <a href="https://blog.sun123zxy.top">blog.sun123zxy.top</a> 获取更多信息。</p>
                </div>
            </div>
        
            <div id="sidebar-links" class="panel">
                
                <h2 class="panel-title">Links</h2>
                
                <div class="panel-content">
                    
<h3>My Friends</h3>
<ul>
    <li><a href="https://www.cnblogs.com/Railgunforever">吸取教训</a></li>
    <li><a href="https://p9t6g.github.io">p9t6g</a></li>
    <li><a href="https://tbyangz.github.io">TbYangZ</a></li>
    <li><a href="https://www.cnblogs.com/ALANALLEN21LOVE28">CJ SYH</a></li>
</ul>

<h3>Related Sites</h3>
<ul>
    <li><a href="http://www.cnblogs.com/sun123zxy">博客园</a></li>
    <li><a href="http://tools.sun123zxy.top">工具站</a></li>
</ul>
                </div>
            </div>
        
            <div id="sidebar-tags" class="panel">
                
                <h2 class="panel-title">Tags</h2>
                
                <div class="panel-content">
                    <ul>
    
    <li><a href= "/tags#OI" >OI</a></li>
    
    <li><a href= "/tags#数学" >数学</a></li>
    
    <li><a href= "/tags#高考" >高考</a></li>
    
    <li><a href= "/tags#题解" >题解</a></li>
    
    <li><a href= "/tags#原创题目" >原创题目</a></li>
    
    <li><a href= "/tags#学习笔记" >学习笔记</a></li>
    
    <li><a href= "/tags#意识流" >意识流</a></li>
    
    <li><a href= "/tags#游记" >游记</a></li>
    
    <li><a href= "/tags#Web" >Web</a></li>
    
    <li><a href= "/tags#站点相关" >站点相关</a></li>
    
    <li><a href= "/tags#Python" >Python</a></li>
    
</ul>
                </div>
            </div>
        
        
            <div id="contents" class="panel"><h2 class="panel-title">Contents</h2>
<div class="panel-content"></div>
<script defer src="/assets/js/contents.js"></script></div>
        
    </div>
    <div class="fclean"></div>
    <div id="footer" class="text-vice">
        <p>sun123zxy's Blog | Powered by Jekyll</p>
    </div>
</div>
<div id="leftdown-float-container">
    <div id="theme-info" class="round-button-handler">
        <div class="round-button"><img src="/assets/images/info.png"></img></div>
        <div class="hover-info">Theme Info</div>
    </div>
    <div id="theme-switch" class="round-button-handler">
        <div class="round-button"><img src="/assets/images/switch.png"></img></div>
        <div class="hover-info">Theme Switch</div>
    </div>
</div>
<div id="rightdown-float-container">
    <div id="music-player" class="round-button-handler">
        <div class="round-button"><img src="/assets/images/music.png"></img></div>
        <div class="hover-info">Music Player</div>
    </div>
</div>
<link rel="stylesheet" href="/assets/css/default.css">
<link rel="stylesheet" id="night-container">
<link rel="stylesheet" id="theme-container">
<div id="mask"></div>
<script src="/assets/js/theme_data.js"></script>
<script src="/assets/js/round_button.js"></script>
<script src="/assets/js/theme_manager.js" defer></script>
<script src="/assets/js/music_player.js"></script>
<script src="/assets/js/scroll.js"></script>
    </body>
</html>